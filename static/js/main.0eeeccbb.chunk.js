(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(t,e,n){},16:function(t,e,n){},17:function(t,e,n){},18:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),s=n(8),c=n.n(s),i=(n(15),n(2)),u=n(3),r=n(5),l=n(4),m=n(1),h=n(6),k=(n(16),n(17),void 0),d={},b={},p=[],f=[],v={production:"wss://stocks.mnet.website",development:"ws://stocks.mnet.website"},S=function(){function t(){Object(i.a)(this,t);var e=v.production;this.socket=new WebSocket(e)}return Object(u.a)(t,[{key:"subscribeForNewStocks",value:function(t){p.push(t)}},{key:"subscribeForMarketStatus",value:function(t){f.push(t)}},{key:"subscribe",value:function(t,e){b[t]||(b[t]=[]),b[t].push(e)}},{key:"unsubscribe",value:function(t,e){b[t]&&(b[t]=[].filter(function(t,n,a){return e!==t}))}},{key:"publish",value:function(t,e){b[t]&&b[t].forEach(function(t){t.call(null,e)})}},{key:"publishNewStock",value:function(t){p.forEach(function(e){e.call(null,t)})}},{key:"publishMarketStatus",value:function(t){f.forEach(function(e){e.call(null,t)})}},{key:"init",value:function(){var t=this;this.socket.onopen=function(){t.publishMarketStatus("The market is up and moving, Connection OK"),console.log("Connected!")},this.socket.onmessage=function(e){JSON.parse(e.data).forEach(function(e){var n=e[0],a=e[1];d[n]||t.publishNewStock(n),d[n]=a,t.publish(n,a)}),console.log(JSON.stringify(d))},this.socket.onclose=function(){t.publishMarketStatus("The market seems closed for now, Connection Lost"),console.log("Lost connection!")},this.socket.onerror=function(){t.publishMarketStatus("There's too much chaos in the market, some ERROR occured"),console.log("Error!")}}},{key:"close",value:function(){this.socket.close()}},{key:"getStockPrice",value:function(t){return d[t]?d[t]:0}}],[{key:"getInstance",value:function(){return void 0===k&&(k=new t),k}}]),t}();S.getInstance();var w=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(r.a)(this,Object(l.a)(e).call(this,t))).name=t.name,n.time=(new Date).getTime(),n.stock=S.getInstance().getStockPrice(n.name),n.updateStock=n.updateStock.bind(Object(m.a)(n)),n.updateTime=n.updateTime.bind(Object(m.a)(n)),n.timer=setTimeout(n.updateTime,1e3),n.state={name:t.name,time:"",stock:"",color:"normal"},n}return Object(h.a)(e,t),Object(u.a)(e,[{key:"updateTime",value:function(t){var e=(new Date).getTime();e=(e-=this.time)<3e4?"Few seconds ago":e<6e3?"Minute(s) ago":new Date(this.time).toLocaleTimeString(),this.setState({time:e}),t||(this.timer=setTimeout(this.updateTime,5e3))}},{key:"updateStock",value:function(t){var e="";this.stock=parseFloat(this.stock),t=parseFloat(t).toFixed(2),e=this.stock<t?"high":this.stock>t?"low":"normal",this.stock=t,this.setState({stock:t,color:e}),this.time=(new Date).getTime(),this.updateTime(!0)}},{key:"componentDidMount",value:function(){S.getInstance().subscribe(this.name,this.updateStock)}},{key:"componentWillUnmount",value:function(){S.getInstance().unsubscribe(this.name,this.updateStock),clearTimeout(this.timer)}},{key:"render",value:function(){return o.a.createElement("tr",null,o.a.createElement("td",null,this.state.name),o.a.createElement("td",{className:this.state.color},this.state.stock),o.a.createElement("td",{className:"timeUpdated"},this.state.time))}}]),e}(o.a.Component),g=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(r.a)(this,Object(l.a)(e).call(this,t))).newStock=n.newStock.bind(Object(m.a)(n)),n.marketStatus=n.marketStatus.bind(Object(m.a)(n)),n.state={stocks:[],status:""},n}return Object(h.a)(e,t),Object(u.a)(e,[{key:"newStock",value:function(t){var e=this.state.stocks;e.push(t),this.setState({stocks:e})}},{key:"marketStatus",value:function(t){this.setState({status:t})}},{key:"componentDidMount",value:function(){S.getInstance().init(),S.getInstance().subscribeForNewStocks(this.newStock),S.getInstance().subscribeForMarketStatus(this.marketStatus)}},{key:"render",value:function(){var t="";return t=0===this.state.stocks.length?o.a.createElement("tr",null,o.a.createElement("td",{colspan:"3"},"Loading ...")):this.state.stocks.map(function(t){return o.a.createElement(w,{name:t})}),o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement("h1",null,this.state.status),o.a.createElement("div",null,o.a.createElement("table",null,o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("td",null,"Stock"),o.a.createElement("td",null,"Price"),o.a.createElement("td",null,"Last Update"))),o.a.createElement("tbody",null,t)))))}}]),e}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(g,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},9:function(t,e,n){t.exports=n(18)}},[[9,1,2]]]);
//# sourceMappingURL=main.0eeeccbb.chunk.js.map